#!/bin/bash
# Instalacion del cluster de Openshift [IPI Mode]

echo "Install Openshift Cluster IPI"

export SUBDOMAIN=f4cd.sandbox1255.opentlc.com
export CLUSTER_NAME=cluster-f4cd
export PULL_SECRET=$(echo "'{"auths":{"cloud.openshift.com":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2dvbnphbG9hY29zdGFzZW1wZXJ0aTFyaTB4Y2RzOGZ3Znd5b3llcW1tNWZ0aGhzbTpETUtaWlYxU0UxU1pDWUpXNFRVQ1BMTllKVEI0MzZGVVU2QjZVWVpLV0I0VEtXOVdRS1dRMEI3OEVYTVY3SEJL","email":"gonzalo.acosta@semperti.com"},"quay.io":{"auth":"b3BlbnNoaWZ0LXJlbGVhc2UtZGV2K2dvbnphbG9hY29zdGFzZW1wZXJ0aTFyaTB4Y2RzOGZ3Znd5b3llcW1tNWZ0aGhzbTpETUtaWlYxU0UxU1pDWUpXNFRVQ1BMTllKVEI0MzZGVVU2QjZVWVpLV0I0VEtXOVdRS1dRMEI3OEVYTVY3SEJL","email":"gonzalo.acosta@semperti.com"},"registry.connect.redhat.com":{"auth":"NTI4NjUwNDh8dWhjLTFSSTB4Y0RzOGZXZldZb1llcU1NNUZ0aEhTbTpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmlZV1ptTnpaa1l6TXhZV1EwTXpnMk9HTXdZekk1WVdaaE5XUTRaamhrTkNKOS5TUnkzeTNZTXVtMFpOU0RrSk5EWFBfcmR6S3pUckwySGFQQ2VHcEFuN25wOFJvUUxhb0t5ekhKTFdjTUZ0SmFROEg1a3VoV3VVN1lncmNYSGlZb1pSRjFoZ0ladC0yOHVLQXdqZXhkckt5UzVCcUswT242bVlMYWtUbDBaMnBTNVQ5TzNmeVVDYjNiMG92TFRWYm9sNEF6VTRjeDRtczc4Ti1vc2dnY1VSWXAwMXVpa3Jja0dpOGdOcnJTWHRmQkRrTDZWajBweV9PWWdfX25kMWF2N3NXWEYwdDhaNUpfSGZyMFRTT1A4YmpHN19YVGF1bllMQnRSZV94Y01KZmFnaFBWdGQ0alkzYTRaSm43WElIS045b1VCQmJERDBBODlxYW13WkJPb3g2UGpYV1VSRnZTWi12dXBiR1FmS0tpeXI5bkFFT0F3aHU0QVBXR241NW5qdDBlb1k5WGZHVmU5RnBhelRuSl9oM3JTbThMQXZSazdjV3pxVWFMc2xKOUtHZ0NxU1l1U1FnQS1rdHdMellHa01ZaFduMzFBaVd1SWhyQmxXVWlCaFc0TGlDMjljMXBtWWRPOUFYVXdlUHZrb19xZmJPcDVQS2NVcjVQRUotUG1yOHhCLUhsZXVRRnZhdjRuaEtOSXZ1VWluQWZJZ2V0d3NiZHNiX1pNQS1BbVVPTnVWay0wdXh4dUxhN3ZGUjVSYVRyWTJKRFJVR1lRVWM3bDc1ZzlKV3UyUDRfNVVVWm1DZzAwQVhGSy00bl9OWXFQeVZkbVFqd21raXVkVkVqX1oxaEtuTm1IM281NGVfOFRaV2h1RGJDSDlmN0M3MTIxNWdjVjFMMFd4ajd4elRTdXZma2ZZZ2M4dXNJc0JNOGdfUkRZcDdMUHNlMTNRQy1scjlVZnA4WQ==","email":"gonzalo.acosta@semperti.com"},"registry.redhat.io":{"auth":"NTI4NjUwNDh8dWhjLTFSSTB4Y0RzOGZXZldZb1llcU1NNUZ0aEhTbTpleUpoYkdjaU9pSlNVelV4TWlKOS5leUp6ZFdJaU9pSmlZV1ptTnpaa1l6TXhZV1EwTXpnMk9HTXdZekk1WVdaaE5XUTRaamhrTkNKOS5TUnkzeTNZTXVtMFpOU0RrSk5EWFBfcmR6S3pUckwySGFQQ2VHcEFuN25wOFJvUUxhb0t5ekhKTFdjTUZ0SmFROEg1a3VoV3VVN1lncmNYSGlZb1pSRjFoZ0ladC0yOHVLQXdqZXhkckt5UzVCcUswT242bVlMYWtUbDBaMnBTNVQ5TzNmeVVDYjNiMG92TFRWYm9sNEF6VTRjeDRtczc4Ti1vc2dnY1VSWXAwMXVpa3Jja0dpOGdOcnJTWHRmQkRrTDZWajBweV9PWWdfX25kMWF2N3NXWEYwdDhaNUpfSGZyMFRTT1A4YmpHN19YVGF1bllMQnRSZV94Y01KZmFnaFBWdGQ0alkzYTRaSm43WElIS045b1VCQmJERDBBODlxYW13WkJPb3g2UGpYV1VSRnZTWi12dXBiR1FmS0tpeXI5bkFFT0F3aHU0QVBXR241NW5qdDBlb1k5WGZHVmU5RnBhelRuSl9oM3JTbThMQXZSazdjV3pxVWFMc2xKOUtHZ0NxU1l1U1FnQS1rdHdMellHa01ZaFduMzFBaVd1SWhyQmxXVWlCaFc0TGlDMjljMXBtWWRPOUFYVXdlUHZrb19xZmJPcDVQS2NVcjVQRUotUG1yOHhCLUhsZXVRRnZhdjRuaEtOSXZ1VWluQWZJZ2V0d3NiZHNiX1pNQS1BbVVPTnVWay0wdXh4dUxhN3ZGUjVSYVRyWTJKRFJVR1lRVWM3bDc1ZzlKV3UyUDRfNVVVWm1DZzAwQVhGSy00bl9OWXFQeVZkbVFqd21raXVkVkVqX1oxaEtuTm1IM281NGVfOFRaV2h1RGJDSDlmN0M3MTIxNWdjVjFMMFd4ajd4elRTdXZma2ZZZ2M4dXNJc0JNOGdfUkRZcDdMUHNlMTNRQy1scjlVZnA4WQ==","email":"gonzalo.acosta@semperti.com"}}}'")
mkdir -p ${CLUSTER_NAME}

cat << EOF > ${CLUSTER_NAME}/install-config.yaml
apiVersion: v1
baseDomain: ${SUBDOMAIN}
compute:
- architecture: amd64
  hyperthreading: Enabled
  name: worker
  platform: {}
  replicas: 3
controlPlane:
  architecture: amd64
  hyperthreading: Enabled
  name: master
  platform: {}
  replicas: 3
metadata:
  creationTimestamp: null
  name: ${CLUSTER_NAME}
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  machineNetwork:
  - cidr: 10.0.0.0/16
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
platform:
  aws:
    region: us-east-2
publish: External
pullSecret: ${PULL_SECRET}" 
EOF

openshift-install create cluster -f ${CLUSTER_NAME}/install-config.yaml